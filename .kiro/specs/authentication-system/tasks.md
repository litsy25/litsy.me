# Implementation Plan

- [x] 1. 데이터베이스 스키마 설정 및 RLS 정책 구현

  - 기존 users 테이블에 필요한 컬럼 추가 (email, email_verified, created_at, updated_at)
  - comments 테이블에 외래키 제약조건 및 updated_at 컬럼 추가
  - Row Level Security 정책 생성 (users, comments, posts 테이블)
  - 필요한 인덱스 생성 및 데이터베이스 최적화
  - _Requirements: 10.1, 10.2, 11.5_

- [x] 2. Supabase 타입 정의 및 클라이언트 설정 업데이트

  - Database 타입 인터페이스를 실제 스키마에 맞게 업데이트
  - User, Comment, Post 관련 TypeScript 인터페이스 정의
  - Supabase 클라이언트 설정에 OAuth 프로바이더 추가
  - 환경 변수 검증 및 설정 확인
  - _Requirements: 5.1, 5.2, 5.3_

- [x] 3. 인증 컨텍스트 및 훅 구현

  - AuthProvider 컨텍스트 생성 (사용자 상태, 세션 관리)
  - useAuth 훅 구현 (로그인, 회원가입, 로그아웃 기능)
  - 세션 상태 지속성 및 자동 갱신 로직 구현
  - 인증 상태 변경 시 사용자 데이터 동기화
  - _Requirements: 1.2, 2.2, 2.4_

- [x] 4. 회원가입 페이지 및 폼 구현

  - /auth/signup 페이지 생성
  - 회원가입 폼 컴포넌트 (이메일, 비밀번호, 닉네임 입력)

  - Zod 스키마를 사용한 클라이언트 사이드 유효성 검사
  - Supabase Auth를 통한 계정 생성 및 이메일 확인 발송
  - 오류 처리 및 사용자 피드백 구현
  - _Requirements: 1.1, 1.2, 1.4, 1.5, 1.6_

- [x] 5. 로그인 페이지 및 폼 구현

  - /auth/login 페이지 생성
  - 로그인 폼 컴포넌트 (이메일, 비밀번호 입력)
  - 로그인 성공 시 리디렉션 로직 구현
  - 로그인 실패 시 오류 메시지 표시
  - "비밀번호 찾기" 링크 추가

  - _Requirements: 2.1, 2.2, 2.3_

- [x] 6. 이메일 인증 시스템 구현

  - /auth/confirm 페이지 생성 (이메일 확인 처리)
  - 이메일 인증 상태 확인 및 표시

  - 이메일 재발송 기능 구현
  - 인증 완료 후 사용자 안내 및 리디렉션
  - 만료된 링크 처리 로직
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 7. 비밀번호 재설정 시스템 구현
  - /auth/reset-password 페이지 생성
  - 비밀번호 재설정 요청 폼 구현
  - 새 비밀번호 설정 폼 구현
  - Supabase를 통한 재설정 이메일 발송
  - 재설정 완료 후 로그인 페이지 리디렉션
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 8. Discord OAuth 로그인 구현
  - Supabase에서 Discord OAuth 프로바이더 설정
  - Discord 로그인 버튼 컴포넌트 구현
  - /auth/callback 페이지 생성 (OAuth 콜백 처리)
  - Discord 사용자 정보를 users 테이블에 동기화
  - OAuth 로그인 오류 처리
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 9. 네비게이션 사용자 메뉴 구현
  - 로그인 상태에 따른 네비게이션 UI 변경
  - UserMenu 드롭다운 컴포넌트 구현
  - 사용자 아바타 및 닉네임 표시
  - 로그아웃 기능 구현
  - 프로필 페이지 링크 추가
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 10. 프로필 페이지 및 수정 기능 구현
  - /profile 페이지 생성
  - 현재 사용자 정보 표시 (닉네임, 이메일, 가입일)
  - 프로필 수정 폼 구현
  - 닉네임 중복 검사 기능
  - 비밀번호 변경 폼 구현
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5_

- [ ] 11. 댓글 시스템 데이터베이스 연동
  - useComments 훅 구현 (댓글 CRUD 작업)
  - 댓글 조회 시 작성자 정보 조인
  - 댓글 작성 시 현재 사용자 ID 저장
  - 댓글 수정/삭제 권한 검사
  - 실시간 댓글 업데이트 구현
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 12. 댓글 컴포넌트 업데이트
  - 기존 CommentForm을 인증된 사용자용으로 수정
  - 로그인하지 않은 사용자에게 로그인 안내 표시
  - 댓글 작성자 정보 표시 (아바타, 닉네임)
  - 본인 댓글에만 수정/삭제 버튼 표시
  - 댓글 수정 인라인 폼 구현
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 13. 보호된 라우트 및 미들웨어 구현
  - ProtectedRoute 컴포넌트 생성
  - Next.js 미들웨어를 통한 인증 상태 확인
  - 인증이 필요한 페이지 보호
  - 로그인하지 않은 사용자 리디렉션 처리
  - 세션 만료 시 자동 로그아웃
  - _Requirements: 2.4, 2.5, 11.2_

- [ ] 14. 오류 처리 및 사용자 피드백 시스템
  - 전역 오류 처리 컨텍스트 구현
  - Supabase 오류를 사용자 친화적 메시지로 변환
  - Toast 알림 시스템 구현 (성공/오류 메시지)
  - 로딩 상태 표시 컴포넌트
  - 폼 유효성 검사 오류 표시
  - _Requirements: 1.4, 1.5, 1.6, 2.3, 4.5_

- [ ] 15. 모바일 반응형 UI 최적화
  - 인증 폼의 모바일 최적화
  - 터치 친화적 버튼 크기 적용
  - 모바일 키보드 타입 설정 (이메일, 비밀번호)
  - 사용자 메뉴의 모바일 드롭다운 구현
  - 댓글 작성/수정 폼의 모바일 최적화
  - _Requirements: 12.1, 12.2, 12.3, 12.4, 12.5_

- [ ] 16. 사용자 데이터 동기화 시스템
  - 회원가입 시 users 테이블 레코드 자동 생성
  - OAuth 로그인 시 사용자 정보 동기화
  - 프로필 업데이트 시 last_synced 필드 갱신
  - 사용자 삭제 시 관련 데이터 정리
  - 데이터 일관성 검사 및 복구 로직
  - _Requirements: 10.1, 10.2, 10.3, 10.4_

- [ ] 17. 통합 테스트 및 E2E 테스트 구현
  - 회원가입 플로우 테스트
  - 로그인/로그아웃 플로우 테스트

  - OAuth 로그인 테스트
  - 모바일 반응형 테스트
  - _Requirements: 전체 요구사항 검증_
