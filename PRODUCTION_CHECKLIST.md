# 🚀 프로덕션 배포 전 체크리스트

## ⚠️ 중요: 데이터베이스 마이그레이션

### 1. 백업 생성
```bash
# Supabase 대시보드에서 데이터베이스 백업 생성
# Settings > Database > Backups
```

### 2. 마이그레이션 실행
```bash
# 로컬에서 Supabase CLI로 마이그레이션 적용
supabase db push

# 또는 Supabase 대시보드에서 SQL 직접 실행:
# SQL Editor에서 005_simplify_auth_system.sql 내용 실행
```

### 3. 기존 사용자 데이터 확인
- 현재 `public.users` 테이블에 데이터가 있는지 확인
- 필요시 데이터 마이그레이션 스크립트 작성

## 🔧 코드 변경사항

### 주요 개선점:
1. **아키텍처 단순화**: 별도 users 테이블 제거, auth.users 직접 사용
2. **성능 향상**: 불필요한 데이터베이스 조회 제거
3. **유지보수성**: 복잡한 동기화 로직 제거
4. **타입 안전성**: 정확한 타입 정의

### 변경된 파일:
- `supabase/migrations/005_simplify_auth_system.sql` (새로 생성)
- `lib/supabase.ts` (타입 정의 단순화)
- `contexts/AuthContext.tsx` (프로필 동기화 로직 제거)
- `lib/types/auth.ts` (불필요한 타입 제거)
- `components/navigation.tsx` (유틸리티 함수 사용)

## 🧪 테스트 계획

### 1. 인증 플로우 테스트
- [ ] Discord OAuth 로그인
- [ ] 이메일/비밀번호 로그인
- [ ] 로그아웃
- [ ] 세션 지속성

### 2. 사용자 데이터 테스트
- [ ] 사용자 정보 표시 (이름, 아바타)
- [ ] 프로필 업데이트
- [ ] 댓글 작성/수정/삭제

### 3. 권한 테스트
- [ ] RLS 정책 작동 확인
- [ ] 본인 데이터만 수정 가능 확인

## 🚨 롤백 계획

문제 발생 시:
1. 데이터베이스 백업으로 복원
2. 이전 코드 버전으로 롤백
3. DNS 설정으로 트래픽 우회

## 📊 모니터링

배포 후 확인사항:
- [ ] 로그인 성공률
- [ ] 오류 로그 모니터링
- [ ] 사용자 피드백 수집
- [ ] 성능 메트릭 확인

## 🎯 성공 기준

- 기존 사용자 로그인 정상 작동
- 새 사용자 회원가입 정상 작동
- 데이터 손실 없음
- 성능 개선 확인